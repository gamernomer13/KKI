"use strict";L.Popup.Angular=L.Popup.extend({onAdd:function(n){L.DivOverlay.prototype.onAdd.call(this,n);var t=this;angular.element(document).ready(function(){if(t._compile(),clearTimeout(t._removeTimeout),t.getPane().appendChild(t._container),t.update(),n._fadeAnimated&&L.DomUtil.setOpacity(t._container,1),n.fire("popupopen",{popup:t}),t._source&&(t._source.fire("popupopen",{popup:t},!0),!(t._source instanceof L.Path)))t._source.on("preclick",L.DomEvent.stopPropagation)})},_compile:function(){var i=this,n=angular.element(document).injector(),t;if(n||(n=angular.element(document.querySelectorAll("[ng-app]")).injector()),!n)throw"L.Popup.Angular can't find your Angular app";var r=n.get("$rootScope"),u=n.get("$compile"),f=n.get("$controller");this._scope=r.$new(!0);this._element=angular.element(this._contentNode);this._element.html(this.options.template);this._$content={_callbacks:[],on:function(n){i._$content._callbacks.push(n)}};this.options.controller&&(t=f(this.options.controller,{$scope:this._scope,$map:this._map,$options:this.options,$content:this._$content}),this.options.controllerAs&&(this._scope[this.options.controllerAs]=t),this._element.data("$ngControllerController",t),this._element.children().data("$ngControllerController",t));u(this._element)(this._scope);this._scope.$apply()},update:function(){if(this._map){var n=this;this._container.style.visibility="hidden";this._scope&&(this._$content._callbacks.map(function(t){t(n._content)}),this.options.controllerAs?this._scope[this.options.controllerAs].$content=this._content:this._scope.$content=this._content,this._scope.$apply(),this._scope.$evalAsync(function(){n.fire("contentupdate");n._updateLayout();n._updatePosition();n._container.style.visibility="";n._adjustPan()}))}},onRemove:function(n){this._scope&&this._scope.$destroy();this._$content&&(this._$content._callbacks=[]);L.Popup.prototype.onRemove.call(this,n)}});L.popup.angular=function(n){return new L.Popup.Angular(n)};