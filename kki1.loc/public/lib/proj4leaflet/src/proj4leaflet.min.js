(function(n){var t,i;if(typeof define=="function"&&define.amd)define(["leaflet","proj4"],n);else if(typeof module=="object"&&typeof module.exports=="object")t=require("leaflet"),i=require("proj4"),module.exports=n(t,i);else{if(typeof window.L=="undefined"||typeof window.proj4=="undefined")throw"Leaflet and proj4 must be loaded first";n(window.L,window.proj4)}})(function(n,t){return t.__esModule&&t.default&&(t=t.default),n.Proj={},n.Proj._isProj4Obj=function(n){return typeof n.inverse!="undefined"&&typeof n.forward!="undefined"},n.Proj.Projection=n.Class.extend({initialize:function(t,i,r){var u=n.Proj._isProj4Obj(t);this._proj=u?t:this._projFromCodeDef(t,i);this.bounds=u?i:r},project:function(t){var i=this._proj.forward([t.lng,t.lat]);return new n.Point(i[0],i[1])},unproject:function(t,i){var r=this._proj.inverse([t.x,t.y]);return new n.LatLng(r[1],r[0],i)},_projFromCodeDef:function(n,i){if(i)t.defs(n,i);else if(t.defs[n]===undefined){var r=n.split(":");if(r.length>3&&(n=r[r.length-3]+":"+r[r.length-1]),t.defs[n]===undefined)throw"No projection definition for code "+n;}return t(n)}}),n.Proj.CRS=n.Class.extend({includes:n.CRS,options:{transformation:new n.Transformation(1,0,-1,0)},initialize:function(t,i,r){var e,o,s,f,u;if(n.Proj._isProj4Obj(t)?(o=t,e=o.srsCode,f=i||{},this.projection=new n.Proj.Projection(o,f.bounds)):(e=t,s=i,f=r||{},this.projection=new n.Proj.Projection(e,s,f.bounds)),n.Util.setOptions(this,f),this.code=e,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new n.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions)for(this._scales=[],u=this.options.resolutions.length-1;u>=0;u--)this.options.resolutions[u]&&(this._scales[u]=1/this.options.resolutions[u]);this.infinite=!this.options.bounds},scale:function(n){var t=Math.floor(n),i,r,u,f;return n===t?this._scales[n]:(i=this._scales[t],r=this._scales[t+1],u=r-i,f=n-t,i+u*f)},zoom:function(n){var t=this._closestElement(this._scales,n),i=this._scales.indexOf(t),r,u,f;return n===t?i:t===undefined?-Infinity:(u=i+1,r=this._scales[u],r===undefined)?Infinity:(f=r-t,(n-t)/f+i)},distance:n.CRS.Earth.distance,R:n.CRS.Earth.R,_closestElement:function(n,t){for(var i,r=n.length;r--;)n[r]<=t&&(i===undefined||i<n[r])&&(i=n[r]);return i}}),n.Proj.GeoJSON=n.GeoJSON.extend({initialize:function(t,i){this._callLevel=0;n.GeoJSON.prototype.initialize.call(this,t,i)},addData:function(t){var i;t&&(t.crs&&t.crs.type==="name"?i=new n.Proj.CRS(t.crs.properties.name):t.crs&&t.crs.type&&(i=new n.Proj.CRS(t.crs.type+":"+t.crs.properties.code)),i!==undefined&&(this.options.coordsToLatLng=function(t){var r=n.point(t[0],t[1]);return i.projection.unproject(r)}));this._callLevel++;try{n.GeoJSON.prototype.addData.call(this,t)}finally{this._callLevel--;this._callLevel===0&&delete this.options.coordsToLatLng}}}),n.Proj.geoJson=function(t,i){return new n.Proj.GeoJSON(t,i)},n.Proj.ImageOverlay=n.ImageOverlay.extend({initialize:function(t,i,r){n.ImageOverlay.prototype.initialize.call(this,t,null,r);this._projectedBounds=i},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),r=n.point(this._projectedBounds.min.x,this._projectedBounds.max.y),u=this._projectedToNewLayerPoint(r,t.zoom,t.center);n.DomUtil.setTransform(this._image,u,i)},_reset:function(){var t=this._map.getZoom(),i=this._map.getPixelOrigin(),r=n.bounds(this._transform(this._projectedBounds.min,t)._subtract(i),this._transform(this._projectedBounds.max,t)._subtract(i)),u=r.getSize();n.DomUtil.setPosition(this._image,r.min);this._image.style.width=u.x+"px";this._image.style.height=u.y+"px"},_projectedToNewLayerPoint:function(n,t,i){var r=this._map.getSize()._divideBy(2),u=this._map.project(i,t)._subtract(r)._round(),f=u.add(this._map._getMapPanePos());return this._transform(n,t)._subtract(f)},_transform:function(n,t){var i=this._map.options.crs,r=i.transformation,u=i.scale(t);return r.transform(n,u)}}),n.Proj.imageOverlay=function(t,i,r){return new n.Proj.ImageOverlay(t,i,r)},n.Proj});